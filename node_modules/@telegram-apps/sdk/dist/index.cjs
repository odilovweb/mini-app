"use strict";var Pt=Object.defineProperty;var Rt=(t,e,s)=>e in t?Pt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var c=(t,e,s)=>Rt(t,typeof e!="symbol"?e+"":e,s);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function ye(t,e){let s;const r=()=>{s!==void 0&&e&&e(s),s=void 0};return[()=>s===void 0?s=t(r):s,r]}function K(t){const e=L(),{count:s}=e;e.unsubscribe(t),s&&!e.count&&Bt()}function Ee(t){return L().subscribe(t),()=>K(t)}class Tt{constructor(e,s={}){this.scope=e,this.options=s}print(e,...s){const r=new Date,n=Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(r),{textColor:i,bgColor:o}=this.options,a="font-weight: bold;padding: 0 5px;border-radius:5px";console[e](`%c${n}%c / %c${this.scope}`,`${a};background-color: lightblue;color:black`,"",`${a};${i?`color:${i};`:""}${o?`background-color:${o}`:""}`,...s)}error(...e){this.print("error",...e)}log(...e){this.print("log",...e)}}const Q=new Tt("SDK",{bgColor:"forestgreen",textColor:"white"});let j=!1;const ge=({name:t,payload:e})=>{Q.log("Event received:",e?{name:t,payload:e}:{name:t})};function Ct(t){j!==t&&(j=t,t?Ee(ge):K(ge))}function At(...t){j&&Q.log(...t)}class S{constructor(){c(this,"listeners",new Map);c(this,"listenersCount",0);c(this,"subscribeListeners",[])}clear(){this.listeners.clear(),this.subscribeListeners=[]}get count(){return this.listenersCount+this.subscribeListeners.length}emit(e,...s){this.subscribeListeners.forEach(n=>n({event:e,args:s})),(this.listeners.get(e)||[]).forEach(([n,i])=>{n(...s),i&&this.off(e,n)})}on(e,s,r){let n=this.listeners.get(e);return n||this.listeners.set(e,n=[]),n.push([s,r]),this.listenersCount+=1,()=>this.off(e,s)}off(e,s){const r=this.listeners.get(e)||[];for(let n=0;n<r.length;n+=1)if(s===r[n][0]){r.splice(n,1),this.listenersCount-=1;return}}subscribe(e){return this.subscribeListeners.push(e),()=>this.unsubscribe(e)}unsubscribe(e){for(let s=0;s<this.subscribeListeners.length;s+=1)if(this.subscribeListeners[s]===e){this.subscribeListeners.splice(s,1);return}}}function J(t,e,s){return window.addEventListener(t,e,s),()=>window.removeEventListener(t,e,s)}function X(...t){let e=!1;const s=t.flat(1);return[r=>!e&&s.push(r),()=>{e||(e=!0,s.forEach(r=>r()))},e]}class k extends Error{constructor(e,s,r){super(s,{cause:r}),this.type=e,Object.setPrototypeOf(this,k.prototype)}}function f(t,e,s){return new k(t,e,s)}const ve="ERR_METHOD_UNSUPPORTED",Se="ERR_METHOD_PARAMETER_UNSUPPORTED",Pe="ERR_UNKNOWN_ENV",Re="ERR_INVOKE_CUSTOM_METHOD_RESPONSE",Te="ERR_TIMED_OUT",Ce="ERR_UNEXPECTED_TYPE",Z="ERR_PARSE",Ae="ERR_NAVIGATION_LIST_EMPTY",Ie="ERR_NAVIGATION_CURSOR_INVALID",It="ERR_NAVIGATION_ITEM_INVALID",xt="ERR_SSR_INIT",xe="ERR_INVALID_PATH_BASE";function T(){return f(Ce,"Value has unexpected type")}class M{constructor(e,s,r){this.parser=e,this.isOptional=s,this.type=r}parse(e){if(!(this.isOptional&&e===void 0))try{return this.parser(e)}catch(s){throw f(Z,`Unable to parse value${this.type?` as ${this.type}`:""}`,s)}}optional(){return this.isOptional=!0,this}}function C(t,e){return()=>new M(t,!1,e)}const w=C(t=>{if(typeof t=="boolean")return t;const e=String(t);if(e==="1"||e==="true")return!0;if(e==="0"||e==="false")return!1;throw T()},"boolean");function Ne(t,e){const s={};for(const r in t){const n=t[r];if(!n)continue;let i,o;if(typeof n=="function"||"parse"in n)i=r,o=typeof n=="function"?n:n.parse.bind(n);else{const{type:a}=n;i=n.from||r,o=typeof a=="function"?a:a.parse.bind(a)}try{const a=o(e(i));a!==void 0&&(s[r]=a)}catch(a){throw f(Z,`Unable to parse field "${r}"`,a)}}return s}function qe(t){let e=t;if(typeof e=="string"&&(e=JSON.parse(e)),typeof e!="object"||e===null||Array.isArray(e))throw T();return e}function g(t,e){return new M(s=>{const r=qe(s);return Ne(t,n=>r[n])},!1,e)}const y=C(t=>{if(typeof t=="number")return t;if(typeof t=="string"){const e=Number(t);if(!Number.isNaN(e))return e}throw T()},"number"),h=C(t=>{if(typeof t=="string"||typeof t=="number")return t.toString();throw T()},"string");function ke(t){return g({eventType:h(),eventData:e=>e}).parse(t)}function Nt(){["TelegramGameProxy_receiveEvent","TelegramGameProxy","Telegram"].forEach(t=>{delete window[t]})}function Y(t,e){window.dispatchEvent(new MessageEvent("message",{data:JSON.stringify({eventType:t,eventData:e}),source:window.parent}))}function qt(){[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach(t=>{let e=window;t.forEach((s,r,n)=>{if(r===n.length-1){e[s]=Y;return}s in e||(e[s]={}),e=e[s]})})}const kt={clipboard_text_received:g({req_id:h(),data:t=>t===null?t:h().optional().parse(t)}),custom_method_invoked:g({req_id:h(),result:t=>t,error:h().optional()}),popup_closed:{parse(t){return g({button_id:e=>e==null?void 0:h().parse(e)}).parse(t??{})}},viewport_changed:g({height:y(),width:t=>t==null?window.innerWidth:y().parse(t),is_state_stable:w(),is_expanded:w()})};function Dt(){const t=new S,e=new S;e.subscribe(r=>{t.emit("event",{name:r.event,payload:r.args[0]})}),qt();const[,s]=X(Nt,J("resize",()=>{e.emit("viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0})}),J("message",r=>{if(r.source!==window.parent)return;let n;try{n=ke(r.data)}catch{return}const{eventType:i,eventData:o}=n,a=kt[i];try{const p=a?a.parse(o):o;e.emit(...p?[i,p]:[i])}catch(p){Q.error(`An error occurred processing the "${i}" event from the Telegram application.
Please, file an issue here:
https://github.com/Telegram-Mini-Apps/telegram-apps/issues/new/choose`,n,p)}}),()=>t.clear(),()=>e.clear());return[{on:e.on.bind(e),off:e.off.bind(e),subscribe(r){return t.on("event",r)},unsubscribe(r){t.off("event",r)},get count(){return e.count+t.count}},s]}const[Vt,Bt]=ye(t=>{const[e,s]=Dt(),r=e.off.bind(e);return e.off=(n,i)=>{const{count:o}=e;r(n,i),o&&!e.count&&t()},[e,s]},([,t])=>t());function L(){return Vt()[0]}function D(t,e){L().off(t,e)}function b(t,e,s){return L().on(t,e,s)}function V(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function De(t,e){const s=t.split("."),r=e.split("."),n=Math.max(s.length,r.length);for(let i=0;i<n;i+=1){const o=parseInt(s[i]||"0",10),a=parseInt(r[i]||"0",10);if(o!==a)return o>a?1:-1}return 0}function _(t,e){return De(t,e)<=0}function E(t,e,s){if(typeof s=="string"){if(t==="web_app_open_link"){if(e==="try_instant_view")return _("6.4",s);if(e==="try_browser")return _("7.6",s)}if(t==="web_app_set_header_color"&&e==="color")return _("6.9",s);if(t==="web_app_close"&&e==="return_back")return _("7.6",s)}switch(t){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return _("6.1",e);case"web_app_open_popup":return _("6.2",e);case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return _("6.4",e);case"web_app_switch_inline_query":return _("6.7",e);case"web_app_invoke_custom_method":case"web_app_request_write_access":case"web_app_request_phone":return _("6.9",e);case"web_app_setup_settings_button":return _("6.10",e);case"web_app_biometry_get_info":case"web_app_biometry_open_settings":case"web_app_biometry_request_access":case"web_app_biometry_request_auth":case"web_app_biometry_update_token":return _("7.2",e);case"web_app_setup_swipe_behavior":return _("7.7",e);default:return["iframe_ready","iframe_will_reload","web_app_close","web_app_data_send","web_app_expand","web_app_open_link","web_app_ready","web_app_request_theme","web_app_request_viewport","web_app_setup_main_button","web_app_setup_closing_behavior"].includes(t)}}function Ve(t){return"external"in t&&V(t.external)&&"notify"in t.external&&typeof t.external.notify=="function"}function Be(t){return"TelegramWebviewProxy"in t&&V(t.TelegramWebviewProxy)&&"postEvent"in t.TelegramWebviewProxy&&typeof t.TelegramWebviewProxy.postEvent=="function"}function ee(){try{return window.self!==window.top}catch{return!0}}const Mt="https://web.telegram.org";let Me=Mt;function Lt(t){Me=t}function Le(){return Me}function P(t,e,s){let r={},n;if(!e&&!s?r={}:e&&s?(r=s,n=e):e&&("targetOrigin"in e?r=e:n=e),At("Posting event:",n?{event:t,data:n}:{event:t}),ee())return window.parent.postMessage(JSON.stringify({eventType:t,eventData:n}),r.targetOrigin||Le());if(Ve(window)){window.external.notify(JSON.stringify({eventType:t,eventData:n}));return}if(Be(window)){window.TelegramWebviewProxy.postEvent(t,JSON.stringify(n));return}throw f(Pe,"Unable to determine current environment and possible way to send event. You are probably trying to use Mini Apps method outside the Telegram application environment.")}function Ue(t){return(e,s)=>{if(!E(e,t))throw f(ve,`Method "${e}" is unsupported in Mini Apps version ${t}`);if(V(s)&&e==="web_app_set_header_color"&&"color"in s&&!E(e,"color",t))throw f(Se,`Parameter "color" of "${e}" method is unsupported in Mini Apps version ${t}`);return P(e,s)}}function te(t){return({req_id:e})=>e===t}function Oe(t){return f(Te,`Timeout reached: ${t}ms`)}function se(t,e){return Promise.race([typeof t=="function"?t():t,new Promise((s,r)=>{setTimeout(()=>{r(Oe(e))},e)})])}async function d(t){let e;const s=new Promise(a=>e=a),{event:r,capture:n,timeout:i}=t,[,o]=X((Array.isArray(r)?r:[r]).map(a=>b(a,p=>{(!n||(Array.isArray(r)?n({event:a,payload:p}):n(p)))&&e(p)})));try{return(t.postEvent||P)(t.method,t.params),await(i?se(s,i):s)}finally{o()}}async function v(t,e,s,r={}){const{result:n,error:i}=await d({...r,method:"web_app_invoke_custom_method",event:"custom_method_invoked",params:{method:t,params:e,req_id:s},capture:te(s)});if(i)throw f(Re,i);return n}function B(...t){return t.map(e=>{if(typeof e=="string")return e;if(V(e))return B(Object.entries(e).map(s=>s[1]&&s[0]));if(Array.isArray(e))return B(...e)}).filter(Boolean).join(" ")}function Ut(...t){return t.reduce((e,s)=>(V(s)&&Object.entries(s).forEach(([r,n])=>{const i=B(e[r],n);i.length&&(e[r]=i)}),e),{})}function U(t){return/^#[\da-f]{6}$/i.test(t)}function $e(t){return/^#[\da-f]{3}$/i.test(t)}function re(t){const e=t.replace(/\s/g,"").toLowerCase();if(U(e))return e;if($e(e)){let r="#";for(let n=0;n<3;n+=1)r+=e[1+n].repeat(2);return r}const s=e.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||e.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(!s)throw new Error(`Value "${t}" does not satisfy any of known RGB formats.`);return s.slice(1).reduce((r,n)=>{const i=parseInt(n,10).toString(16);return r+(i.length===1?"0":"")+i},"#")}function ne(t){const e=re(t);return Math.sqrt([.299,.587,.114].reduce((s,r,n)=>{const i=parseInt(e.slice(1+n*2,1+(n+1)*2),16);return s+i*i*r},0))<120}class Ot{constructor(e){c(this,"ee",new S);c(this,"on",this.ee.on.bind(this.ee));c(this,"off",this.ee.off.bind(this.ee));this.state=e}clone(){return{...this.state}}set(e,s){Object.entries(typeof e=="string"?{[e]:s}:e).reduce((n,[i,o])=>this.state[i]===o||o===void 0?n:(this.state[i]=o,this.ee.emit(`change:${i}`,o),!0),!1)&&this.ee.emit("change",this.state)}get(e){return this.state[e]}}class ie{constructor(e){c(this,"state");c(this,"get");c(this,"set");c(this,"clone");this.state=new Ot(e),this.set=this.state.set.bind(this.state),this.get=this.state.get.bind(this.state),this.clone=this.state.clone.bind(this.state)}}function We(t,e){return s=>E(e[s],t)}class oe extends ie{constructor(s,r,n){super(s);c(this,"supports");this.supports=We(r,n)}}class He extends oe{constructor(s,r,n){super({isVisible:s},r,{show:"web_app_setup_back_button",hide:"web_app_setup_back_button"});c(this,"on",(s,r)=>s==="click"?b("back_button_pressed",r):this.state.on(s,r));c(this,"off",(s,r)=>s==="click"?D("back_button_pressed",r):this.state.off(s,r));this.postEvent=n}set isVisible(s){this.set("isVisible",s),this.postEvent("web_app_setup_back_button",{is_visible:s})}get isVisible(){return this.get("isVisible")}hide(){this.isVisible=!1}show(){this.isVisible=!0}}const ae=C(t=>t instanceof Date?t:new Date(y().parse(t)*1e3),"Date");function O(t,e){return new M(s=>{if(typeof s!="string"&&!(s instanceof URLSearchParams))throw T();const r=typeof s=="string"?new URLSearchParams(s):s;return Ne(t,n=>{const i=r.get(n);return i===null?void 0:i})},!1,e)}const $t=g({id:y(),type:h(),title:h(),photoUrl:{type:h().optional(),from:"photo_url"},username:h().optional()},"Chat").optional(),be=g({addedToAttachmentMenu:{type:w().optional(),from:"added_to_attachment_menu"},allowsWriteToPm:{type:w().optional(),from:"allows_write_to_pm"},firstName:{type:h(),from:"first_name"},id:y(),isBot:{type:w().optional(),from:"is_bot"},isPremium:{type:w().optional(),from:"is_premium"},languageCode:{type:h().optional(),from:"language_code"},lastName:{type:h().optional(),from:"last_name"},photoUrl:{type:h().optional(),from:"photo_url"},username:h().optional()},"User").optional();function Ge(){return O({authDate:{type:ae(),from:"auth_date"},canSendAfter:{type:y().optional(),from:"can_send_after"},chat:$t,chatInstance:{type:h().optional(),from:"chat_instance"},chatType:{type:h().optional(),from:"chat_type"},hash:h(),queryId:{type:h().optional(),from:"query_id"},receiver:be,startParam:{type:h().optional(),from:"start_param"},user:be},"InitData")}const ze=C(t=>re(h().parse(t)),"rgb");function Wt(t){return t.replace(/_[a-z]/g,e=>e[1].toUpperCase())}function Ht(t){return t.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`)}const Fe=C(t=>{const e=ze().optional();return Object.entries(qe(t)).reduce((s,[r,n])=>(s[Wt(r)]=e.parse(n),s),{})},"ThemeParams");function $(t){return O({botInline:{type:w().optional(),from:"tgWebAppBotInline"},initData:{type:Ge().optional(),from:"tgWebAppData"},initDataRaw:{type:h().optional(),from:"tgWebAppData"},platform:{type:h(),from:"tgWebAppPlatform"},showSettings:{type:w().optional(),from:"tgWebAppShowSettings"},startParam:{type:h().optional(),from:"tgWebAppStartParam"},themeParams:{type:Fe(),from:"tgWebAppThemeParams"},version:{type:h(),from:"tgWebAppVersion"}}).parse(t)}function je(t){return $(t.replace(/^[^?#]*[?#]/,"").replace(/[?#]/g,"&"))}function Gt(){return je(window.location.href)}function Je(){return performance.getEntriesByType("navigation")[0]}function zt(){const t=Je();if(!t)throw new Error("Unable to get first navigation entry.");return je(t.name)}function Ye(t){return`telegram-apps/${t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}`}function Ke(t,e){sessionStorage.setItem(Ye(t),JSON.stringify(e))}function Qe(t){const e=sessionStorage.getItem(Ye(t));try{return e?JSON.parse(e):void 0}catch{}}function Ft(){return $(Qe("launchParams")||"")}function ce(t){return JSON.stringify(Object.fromEntries(Object.entries(t).map(([e,s])=>[Ht(e),s])))}function Xe(t){const{initDataRaw:e,themeParams:s,platform:r,version:n,showSettings:i,startParam:o,botInline:a}=t,p=new URLSearchParams;return p.set("tgWebAppPlatform",r),p.set("tgWebAppThemeParams",ce(s)),p.set("tgWebAppVersion",n),e&&p.set("tgWebAppData",e),o&&p.set("tgWebAppStartParam",o),typeof i=="boolean"&&p.set("tgWebAppShowSettings",i?"1":"0"),typeof a=="boolean"&&p.set("tgWebAppBotInline",a?"1":"0"),p.toString()}function Ze(t){Ke("launchParams",Xe(t))}function et(){for(const t of[Gt,zt,Ft])try{const e=t();return Ze(e),e}catch{}throw new Error(`Unable to retrieve launch parameters from any known source. Perhaps, you have opened your app outside of Telegram?

📖 Refer to docs for more information:
https://docs.telegram-mini-apps.com/packages/telegram-apps-sdk/environment`)}function pe(){const t=Je();return!!(t&&t.type==="reload")}function jt(){let t=0;return()=>(t+=1).toString()}const[Jt]=ye(jt);function l(t,e){return()=>{const s=et(),r={...s,postEvent:Ue(s.version),createRequestId:Jt()};if(typeof t=="function")return t(r);const[n,i,o]=X(),a=e({...r,state:pe()?Qe(t):void 0,addCleanup:n}),p=u=>(o||n(u.on("change",St=>{Ke(t,St)})),u);return[a instanceof Promise?a.then(p):p(a),i]}}const Yt=l("backButton",({postEvent:t,version:e,state:s={isVisible:!1}})=>new He(s.isVisible,e,t));class A extends oe{constructor(){super(...arguments);c(this,"on",this.state.on.bind(this.state));c(this,"off",this.state.off.bind(this.state))}}function tt(t){const e=t.available?t:{available:!1,device_id:"",token_saved:!1,access_requested:!1,access_granted:!1,type:""};return{available:!0,type:e.type,deviceId:e.device_id,tokenSaved:e.token_saved,accessRequested:e.access_requested,accessGranted:e.access_granted}}class st extends A{constructor({postEvent:s,version:r,...n}){super(n,r,{auth:"web_app_biometry_request_auth",openSettings:"web_app_biometry_open_settings",requestAccess:"web_app_biometry_request_access",updateToken:"web_app_biometry_update_token"});c(this,"postEvent");c(this,"authPromise");c(this,"accessPromise");this.postEvent=s}get available(){return this.get("available")}get accessGranted(){return this.get("accessGranted")}get accessRequested(){return this.get("accessRequested")}async authenticate({reason:s,...r}){return this.authPromise||(this.authPromise=d({...r,method:"web_app_biometry_request_auth",event:"biometry_auth_requested",postEvent:this.postEvent,params:{reason:(s||"").trim()}}).then(({token:n})=>n).finally(()=>this.authPromise=void 0)),this.authPromise}get deviceId(){return this.get("deviceId")}openSettings(){this.postEvent("web_app_biometry_open_settings")}requestAccess({reason:s,...r}={}){return this.accessPromise||(this.accessPromise=d({...r,postEvent:this.postEvent,method:"web_app_biometry_request_access",event:"biometry_info_received",params:{reason:s||""}}).then(n=>{const i=tt(n);return this.set(i),i.accessGranted}).finally(()=>this.accessPromise=void 0)),this.accessPromise}get biometryType(){return this.get("biometryType")}get tokenSaved(){return this.get("tokenSaved")}async updateToken({token:s,...r}={}){return["removed","updated"].includes((await d({...r,postEvent:this.postEvent,method:"web_app_biometry_update_token",event:"biometry_token_updated",params:{token:s||""}})).status)}}async function rt(t){return tt(await d({...t||{},method:"web_app_biometry_get_info",event:"biometry_info_received"}))}const Kt=l("biometryManager",async({postEvent:t,version:e,state:s})=>new st({...s||E("web_app_biometry_get_info",e)?s||await rt({timeout:1e3}):{available:!1,accessGranted:!1,accessRequested:!1,tokenSaved:!1,deviceId:""},version:e,postEvent:t}));class he extends ie{constructor(){super(...arguments);c(this,"on",this.state.on.bind(this.state));c(this,"off",this.state.off.bind(this.state))}}class nt extends he{constructor(e,s){super({isConfirmationNeeded:e}),this.postEvent=s}set isConfirmationNeeded(e){this.set("isConfirmationNeeded",e),this.postEvent("web_app_setup_closing_behavior",{need_confirmation:e})}get isConfirmationNeeded(){return this.get("isConfirmationNeeded")}disableConfirmation(){this.isConfirmationNeeded=!1}enableConfirmation(){this.isConfirmationNeeded=!0}}const Qt=l("closingBehavior",({postEvent:t,state:e={isConfirmationNeeded:!1}})=>new nt(e.isConfirmationNeeded,t));class ue{constructor(e,s){c(this,"supports");this.supports=We(e,s)}}function Xt(t){if(Array.isArray(t))return t;if(typeof t=="string")try{const e=JSON.parse(t);if(Array.isArray(e))return e}catch{}throw T()}class Zt extends M{constructor(s,r,n){super(Xt,r,n);c(this,"itemParser");this.itemParser=typeof s=="function"?s:s.parse.bind(s)}parse(s){const r=super.parse(s);return r===void 0?r:r.map(this.itemParser)}of(s){return this.itemParser=typeof s=="function"?s:s.parse.bind(s),this}}function it(t){return new Zt(e=>e,!1,t)}function we(t,e){return Object.fromEntries(t.map(s=>[s,e]))}class ot extends ue{constructor(e,s,r){super(e,{delete:"web_app_invoke_custom_method",get:"web_app_invoke_custom_method",getKeys:"web_app_invoke_custom_method",set:"web_app_invoke_custom_method"}),this.createRequestId=s,this.postEvent=r}async delete(e,s={}){const r=Array.isArray(e)?e:[e];r.length&&await v("deleteStorageValues",{keys:r},this.createRequestId(),{...s,postEvent:this.postEvent})}async getKeys(e={}){return it().of(h()).parse(await v("getStorageKeys",{},this.createRequestId(),{...e,postEvent:this.postEvent}))}async get(e,s={}){const r=Array.isArray(e)?e:[e];if(!r.length)return we(r,"");const n=await v("getStorageValues",{keys:r},this.createRequestId(),{...s,postEvent:this.postEvent}),i=g(we(r,h()),"CloudStorageData").parse(n);return Array.isArray(e)?i:i[e]}async set(e,s,r={}){await v("saveStorageValue",{key:e,value:s},this.createRequestId(),{...r,postEvent:this.postEvent})}}const es=l(({createRequestId:t,postEvent:e,version:s})=>new ot(s,t,e));class at extends ue{constructor(e,s){super(e,{impactOccurred:"web_app_trigger_haptic_feedback",notificationOccurred:"web_app_trigger_haptic_feedback",selectionChanged:"web_app_trigger_haptic_feedback"}),this.postEvent=s}impactOccurred(e){this.postEvent("web_app_trigger_haptic_feedback",{type:"impact",impact_style:e})}notificationOccurred(e){this.postEvent("web_app_trigger_haptic_feedback",{type:"notification",notification_type:e})}selectionChanged(){this.postEvent("web_app_trigger_haptic_feedback",{type:"selection_change"})}}const ts=l(({version:t,postEvent:e})=>new at(t,e));class ct{constructor(e){this.initData=e}get authDate(){return this.initData.authDate}get canSendAfter(){return this.initData.canSendAfter}get canSendAfterDate(){const{canSendAfter:e}=this;return e?new Date(this.authDate.getTime()+e*1e3):void 0}get chat(){return this.initData.chat}get chatType(){return this.initData.chatType}get chatInstance(){return this.initData.chatInstance}get hash(){return this.initData.hash}get queryId(){return this.initData.queryId}get receiver(){return this.initData.receiver}get startParam(){return this.initData.startParam}get user(){return this.initData.user}}const ss=l(({initData:t})=>t?new ct(t):void 0);function rs(t){return Ge().parse(t)}class pt extends A{constructor(e,s,r){super({isOpened:e},s,{open:"web_app_open_invoice"}),this.postEvent=r}set isOpened(e){this.set("isOpened",e)}get isOpened(){return this.get("isOpened")}async open(e,s){if(this.isOpened)throw new Error("Invoice is already opened");let r;if(!s)r=e;else{const{hostname:n,pathname:i}=new URL(e,window.location.href);if(n!=="t.me")throw new Error(`Incorrect hostname: ${n}`);const o=i.match(/^\/(\$|invoice\/)([A-Za-z0-9\-_=]+)$/);if(!o)throw new Error('Link pathname has incorrect format. Expected to receive "/invoice/{slug}" or "/${slug}"');[,,r]=o}this.isOpened=!0;try{return(await d({method:"web_app_open_invoice",event:"invoice_closed",params:{slug:r},postEvent:this.postEvent,capture(i){return r===i.slug}})).status}finally{this.isOpened=!1}}}const ns=l(({version:t,postEvent:e})=>new pt(!1,t,e));class ht extends ie{constructor({postEvent:s,...r}){super(r);c(this,"postEvent");c(this,"on",(s,r)=>s==="click"?b("main_button_pressed",r):this.state.on(s,r));c(this,"off",(s,r)=>s==="click"?D("main_button_pressed",r):this.state.off(s,r));this.postEvent=s}get bgColor(){return this.get("bgColor")}commit(){this.text!==""&&this.postEvent("web_app_setup_main_button",{is_visible:this.isVisible,is_active:this.isEnabled,is_progress_visible:this.isLoaderVisible,text:this.text,color:this.bgColor,text_color:this.textColor})}disable(){return this.isEnabled=!1,this}enable(){return this.isEnabled=!0,this}hide(){return this.isVisible=!1,this}hideLoader(){return this.isLoaderVisible=!1,this}set isEnabled(s){this.setParams({isEnabled:s})}get isEnabled(){return this.get("isEnabled")}set isLoaderVisible(s){this.setParams({isLoaderVisible:s})}get isLoaderVisible(){return this.get("isLoaderVisible")}set isVisible(s){this.setParams({isVisible:s})}get isVisible(){return this.get("isVisible")}show(){return this.isVisible=!0,this}showLoader(){return this.isLoaderVisible=!0,this}setText(s){return this.setParams({text:s})}setTextColor(s){return this.setParams({textColor:s})}setBgColor(s){return this.setParams({bgColor:s})}setParams(s){return this.set(s),this.commit(),this}get text(){return this.get("text")}get textColor(){return this.get("textColor")}}const is=l("mainButton",({postEvent:t,themeParams:e,state:s={isVisible:!1,isEnabled:!1,text:"",isLoaderVisible:!1,textColor:e.buttonTextColor||"#ffffff",bgColor:e.buttonColor||"#000000"}})=>new ht({...s,postEvent:t}));function os(){return O({contact:g({userId:{type:y(),from:"user_id"},phoneNumber:{type:h(),from:"phone_number"},firstName:{type:h(),from:"first_name"},lastName:{type:h().optional(),from:"last_name"}}),authDate:{type:ae(),from:"auth_date"},hash:h()},"RequestedContact")}function ut(t,e){return s=>{const[r,n]=e[s];return E(r,n,t)}}function as(t){return new Promise(e=>{setTimeout(e,t)})}class lt extends A{constructor({postEvent:s,createRequestId:r,version:n,botInline:i,...o}){super(o,n,{requestPhoneAccess:"web_app_request_phone",requestWriteAccess:"web_app_request_write_access",switchInlineQuery:"web_app_switch_inline_query",setHeaderColor:"web_app_set_header_color",setBackgroundColor:"web_app_set_background_color"});c(this,"botInline");c(this,"postEvent");c(this,"createRequestId");c(this,"requestPhoneAccessPromise");c(this,"requestWriteAccessPromise");c(this,"supportsParam");this.createRequestId=r,this.postEvent=s,this.botInline=i;const a=this.supports.bind(this);this.supports=p=>a(p)?p!=="switchInlineQuery"||i:!1,this.supportsParam=ut(n,{"setHeaderColor.color":["web_app_set_header_color","color"],"close.returnBack":["web_app_close","return_back"]})}async getRequestedContact({timeout:s=1e4}={}){return os().parse(await v("getRequestedContact",{},this.createRequestId(),{postEvent:this.postEvent,timeout:s}))}get bgColor(){return this.get("bgColor")}close(s){this.postEvent("web_app_close",this.supportsParam("close.returnBack")?{return_back:s}:{})}get headerColor(){return this.get("headerColor")}get isBotInline(){return this.botInline}get isDark(){return ne(this.bgColor)}ready(){this.postEvent("web_app_ready")}async requestContact({timeout:s=5e3}={}){try{return await this.getRequestedContact()}catch{}if(await this.requestPhoneAccess()!=="sent")throw new Error("Access denied.");const n=Date.now()+s;let i=50;return se(async()=>{for(;Date.now()<n;){try{return await this.getRequestedContact()}catch{}await as(i),i+=50}throw Oe(s)},s)}async requestPhoneAccess(s={}){return this.requestPhoneAccessPromise||(this.requestPhoneAccessPromise=d({...s,method:"web_app_request_phone",event:"phone_requested",postEvent:this.postEvent}).then(({status:r})=>r).finally(()=>this.requestPhoneAccessPromise=void 0)),this.requestPhoneAccessPromise}async requestWriteAccess(s={}){return this.requestWriteAccessPromise||(this.requestWriteAccessPromise=d({...s,method:"web_app_request_write_access",event:"write_access_requested",postEvent:this.postEvent}).then(({status:r})=>r).finally(()=>this.requestWriteAccessPromise=void 0)),this.requestWriteAccessPromise}sendData(s){const{size:r}=new Blob([s]);if(!r||r>4096)throw new Error(`Passed data has incorrect size: ${r}`);this.postEvent("web_app_data_send",{data:s})}setHeaderColor(s){this.postEvent("web_app_set_header_color",U(s)?{color:s}:{color_key:s}),this.set("headerColor",s)}setBgColor(s){this.postEvent("web_app_set_background_color",{color:s}),this.set("bgColor",s)}switchInlineQuery(s,r=[]){if(!this.supports("switchInlineQuery")&&!this.isBotInline)throw new Error("Method is unsupported because Mini App should be launched in inline mode.");this.postEvent("web_app_switch_inline_query",{query:s,chat_types:r})}}const cs=l("miniApp",({themeParams:t,botInline:e=!1,state:s={bgColor:t.bgColor||"#ffffff",headerColor:t.headerBgColor||"#000000"},...r})=>new lt({...r,...s,botInline:e}));function ps(t){const e=t.message.trim(),s=(t.title||"").trim(),r=t.buttons||[];let n;if(s.length>64)throw new Error(`Title has incorrect size: ${s.length}`);if(!e.length||e.length>256)throw new Error(`Message has incorrect size: ${e.length}`);if(r.length>3)throw new Error(`Buttons have incorrect size: ${r.length}`);return r.length?n=r.map(i=>{const{id:o=""}=i;if(o.length>64)throw new Error(`Button ID has incorrect size: ${o}`);if(!i.type||i.type==="default"||i.type==="destructive"){const a=i.text.trim();if(!a.length||a.length>64){const p=i.type||"default";throw new Error(`Button text with type "${p}" has incorrect size: ${i.text.length}`)}return{...i,text:a,id:o}}return{...i,id:o}}):n=[{type:"close",id:""}],{title:s,message:e,buttons:n}}class dt extends A{constructor(e,s,r){super({isOpened:e},s,{open:"web_app_open_popup"}),this.postEvent=r}set isOpened(e){this.set("isOpened",e)}get isOpened(){return this.get("isOpened")}async open(e){if(this.isOpened)throw new Error("Popup is already opened.");this.isOpened=!0;try{const{button_id:s=null}=await d({event:"popup_closed",method:"web_app_open_popup",postEvent:this.postEvent,params:ps(e)});return s}finally{this.isOpened=!1}}}const hs=l(({postEvent:t,version:e})=>new dt(!1,e,t));class _t extends A{constructor(e,s,r){super({isOpened:e},s,{close:"web_app_close_scan_qr_popup",open:"web_app_open_scan_qr_popup"}),this.postEvent=r}close(){this.postEvent("web_app_close_scan_qr_popup"),this.isOpened=!1}set isOpened(e){this.set("isOpened",e)}get isOpened(){return this.get("isOpened")}async open(e){if(this.isOpened)throw new Error("The scanner is already opened");const{text:s,capture:r}=(typeof e=="string"?{text:e}:e)||{};this.isOpened=!0;try{const i=(await d({method:"web_app_open_scan_qr_popup",event:["qr_text_received","scan_qr_popup_closed"],postEvent:this.postEvent,params:{text:s},capture(o){return o.event==="scan_qr_popup_closed"||!r||r(o.payload)}})||{}).data||null;return i&&this.close(),i}finally{this.isOpened=!1}}}const us=l(({version:t,postEvent:e})=>new _t(!1,t,e));class ft extends oe{constructor(s,r,n){super({isVisible:s},r,{show:"web_app_setup_settings_button",hide:"web_app_setup_settings_button"});c(this,"on",(s,r)=>s==="click"?b("settings_button_pressed",r):this.state.on(s,r));c(this,"off",(s,r)=>s==="click"?D("settings_button_pressed",r):this.state.off(s,r));this.postEvent=n}set isVisible(s){this.set("isVisible",s),this.postEvent("web_app_setup_settings_button",{is_visible:s})}get isVisible(){return this.get("isVisible")}hide(){this.isVisible=!1}show(){this.isVisible=!0}}const ls=l("settingsButton",({version:t,postEvent:e,state:s={isVisible:!1}})=>new ft(s.isVisible,t,e));class gt extends A{constructor(e,s,r){super({isVerticalSwipeEnabled:e},s,{disableVerticalSwipe:"web_app_setup_swipe_behavior",enableVerticalSwipe:"web_app_setup_swipe_behavior"}),this.postEvent=r}set isVerticalSwipeEnabled(e){this.set("isVerticalSwipeEnabled",e),this.postEvent("web_app_setup_swipe_behavior",{allow_vertical_swipe:e})}get isVerticalSwipeEnabled(){return this.get("isVerticalSwipeEnabled")}disableVerticalSwipe(){this.isVerticalSwipeEnabled=!1}enableVerticalSwipe(){this.isVerticalSwipeEnabled=!0}}const ds=l("swipeBehavior",({postEvent:t,state:e={isVerticalSwipeEnabled:!0},version:s})=>new gt(e.isVerticalSwipeEnabled,s,t));function le(t){return Fe().parse(t)}class bt extends he{get accentTextColor(){return this.get("accentTextColor")}get bgColor(){return this.get("bgColor")}get buttonColor(){return this.get("buttonColor")}get buttonTextColor(){return this.get("buttonTextColor")}get destructiveTextColor(){return this.get("destructiveTextColor")}getState(){return this.clone()}get headerBgColor(){return this.get("headerBgColor")}get hintColor(){return this.get("hintColor")}get isDark(){return!this.bgColor||ne(this.bgColor)}get linkColor(){return this.get("linkColor")}get secondaryBgColor(){return this.get("secondaryBgColor")}get sectionBgColor(){return this.get("sectionBgColor")}get sectionHeaderTextColor(){return this.get("sectionHeaderTextColor")}get sectionSeparatorColor(){return this.get("sectionHeaderTextColor")}listen(){return b("theme_changed",e=>{this.set(le(e.theme_params))})}get subtitleTextColor(){return this.get("subtitleTextColor")}get textColor(){return this.get("textColor")}}const _s=l("themeParams",({themeParams:t,state:e=t,addCleanup:s})=>{const r=new bt(e);return s(r.listen()),r});function fs(t={}){return d({...t,method:"web_app_request_theme",event:"theme_changed"}).then(le)}function N(t,e){return t.startsWith(e)?t:`${e}${t}`}function R(t){return new URL(typeof t=="string"?t:`${t.pathname||""}${N(t.search||"","?")}${N(t.hash||"","#")}`,"http://a")}class wt extends ue{constructor(s,r,n){super(s,{readTextFromClipboard:"web_app_read_text_from_clipboard"});c(this,"supportsParam");this.version=s,this.createRequestId=r,this.postEvent=n,this.supportsParam=ut(s,{"openLink.tryInstantView":["web_app_open_link","try_instant_view"]})}openLink(s,r){const n=R(s).toString();if(!E("web_app_open_link",this.version)){window.open(n,"_blank");return}const i=typeof r=="boolean"?{tryInstantView:r}:r||{};this.postEvent("web_app_open_link",{url:n,try_browser:i.tryBrowser,try_instant_view:i.tryInstantView})}openTelegramLink(s){const{hostname:r,pathname:n,search:i}=new URL(s,"https://t.me");if(r!=="t.me")throw new Error(`URL has not allowed hostname: ${r}. Only "t.me" is allowed`);if(!E("web_app_open_tg_link",this.version)){window.location.href=s;return}this.postEvent("web_app_open_tg_link",{path_full:n+i})}async readTextFromClipboard(){const s=this.createRequestId(),{data:r=null}=await d({method:"web_app_read_text_from_clipboard",event:"clipboard_text_received",postEvent:this.postEvent,params:{req_id:s},capture:te(s)});return r}shareURL(s,r){this.openTelegramLink("https://t.me/share/url?"+new URLSearchParams({url:s,text:r||""}).toString().replace(/\+/g,"%20"))}}const gs=l(({version:t,postEvent:e,createRequestId:s})=>new wt(t,s,e));async function de(t={}){const{is_expanded:e,is_state_stable:s,...r}=await d({...t,method:"web_app_request_viewport",event:"viewport_changed"});return{...r,isExpanded:e,isStateStable:s}}function I(t){return t<0?0:t}class mt extends he{constructor({postEvent:s,stableHeight:r,height:n,width:i,isExpanded:o}){super({height:I(n),isExpanded:o,stableHeight:I(r),width:I(i)});c(this,"postEvent");this.postEvent=s}async sync(s){const{isStateStable:r,...n}=await de(s);this.set({...n,stableHeight:r?n.height:this.get("stableHeight")})}get height(){return this.get("height")}get stableHeight(){return this.get("stableHeight")}listen(){return b("viewport_changed",s=>{const{height:r,width:n,is_expanded:i,is_state_stable:o}=s,a=I(r);this.set({height:a,isExpanded:i,width:I(n),...o?{stableHeight:a}:{}})})}get isExpanded(){return this.get("isExpanded")}get width(){return this.get("width")}expand(){this.postEvent("web_app_expand"),this.set("isExpanded",!0)}get isStable(){return this.stableHeight===this.height}}const bs=l("viewport",async({state:t,platform:e,postEvent:s,addCleanup:r})=>{let n=!1,i=0,o=0,a=0;if(t)n=t.isExpanded,i=t.height,o=t.width,a=t.stableHeight;else if(["macos","tdesktop","unigram","webk","weba","web"].includes(e))n=!0,i=window.innerHeight,o=window.innerWidth,a=window.innerHeight;else{const u=await de({timeout:1e3,postEvent:s});n=u.isExpanded,i=u.height,o=u.width,a=u.isStateStable?i:0}const p=new mt({postEvent:s,height:i,width:o,stableHeight:a,isExpanded:n});return r(p.listen()),p});function m(t,e){document.documentElement.style.setProperty(t,e)}function ws(t,e,s){s||(s=a=>`--tg-${a}-color`);const r=s("header"),n=s("bg"),i=()=>{const{headerColor:a}=t;if(U(a))m(r,a);else{const{bgColor:p,secondaryBgColor:u}=e;a==="bg_color"&&p?m(r,p):a==="secondary_bg_color"&&u&&m(r,u)}m(n,t.bgColor)},o=[e.on("change",i),t.on("change",i)];return i(),()=>o.forEach(a=>a())}function ms(t,e){e||(e=r=>`--tg-theme-${r.replace(/[A-Z]/g,n=>`-${n.toLowerCase()}`)}`);const s=()=>{Object.entries(t.getState()).forEach(([r,n])=>{n&&m(e(r),n)})};return s(),t.on("change",s)}function ys(t,e){e||(e=u=>`--tg-viewport-${u}`);const[s,r,n]=["height","width","stable-height"].map(u=>e(u)),i=()=>m(s,`${t.height}px`),o=()=>m(r,`${t.width}px`),a=()=>m(n,`${t.stableHeight}px`),p=[t.on("change:height",i),t.on("change:width",o),t.on("change:stableHeight",a)];return i(),o(),a(),()=>p.forEach(u=>u())}function Es(t=!0){const e=[b("reload_iframe",()=>{P("iframe_will_reload"),window.location.reload()})],s=()=>e.forEach(r=>r());if(t){const r=document.createElement("style");r.id="telegram-custom-styles",document.head.appendChild(r),e.push(b("set_custom_style",n=>{r.innerHTML=n}),()=>document.head.removeChild(r))}return P("iframe_ready",{reload_supported:!0}),s}function vs(){return typeof window>"u"}async function Ss(){if(Be(window))return!0;try{return await d({method:"web_app_request_theme",event:"theme_changed",timeout:100}),!0}catch{return!1}}function Ps(t){const e=typeof t=="string"?$(t):t;Ze(e);function s(n){if(typeof n=="string")try{const{eventType:i}=ke(n);i==="web_app_request_theme"&&Y("theme_changed",{theme_params:JSON.parse(ce(e.themeParams))}),i==="web_app_request_viewport"&&Y("viewport_changed",{width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0})}catch{}}if(ee()){const n=window.parent.postMessage.bind(window.parent);window.parent.postMessage=i=>{s(i),n(i)};return}if(Ve(window)){const n=window.external.notify.bind(window.external);window.external.notify=i=>{s(i),n(i)};return}const r=window.TelegramWebviewProxy;window.TelegramWebviewProxy={...r||{},postEvent(...n){s(JSON.stringify({eventType:n[0],eventData:n[1]})),r&&r.postEvent(...n)}}}function yt(t){return t instanceof k}function Rs(t,e){return yt(t)&&t.type===e}function W(t,e){let s,r,n;return typeof t=="string"?s=t:(s=t.pathname===void 0?e:t.pathname,r=t.params,n=t.id),Object.freeze({id:n||(Math.random()*2**14|0).toString(16),pathname:s,params:r})}class Et{constructor(e,s,r=P){c(this,"history");c(this,"ee",new S);c(this,"attached",!1);c(this,"back",()=>this.go(-1));c(this,"on",this.ee.on.bind(this.ee));c(this,"off",this.ee.off.bind(this.ee));if(this._index=s,this.postEvent=r,e.length===0)throw f(Ae,"History should not be empty.");if(s<0||s>=e.length)throw f(Ie,"Index should not be zero and higher or equal than history size.");this.history=e.map(n=>W(n,""))}attach(){this.attached||(this.attached=!0,this.sync(),b("back_button_pressed",this.back))}get current(){return this.history[this.index]}detach(){this.attached=!1,D("back_button_pressed",this.back)}forward(){this.go(1)}go(e,s){const r=this.index+e,n=Math.min(Math.max(0,r),this.history.length-1);(r===n||s)&&this.replaceAndMove(n,this.history[n])}goTo(e,s){this.go(e-this.index,s)}get hasPrev(){return this.index>0}get hasNext(){return this.index!==this.history.length-1}get index(){return this._index}push(e){this.hasNext&&this.history.splice(this.index+1),this.replaceAndMove(this.index+1,W(e,this.current.pathname))}replace(e){this.replaceAndMove(this.index,W(e,this.current.pathname))}replaceAndMove(e,s){const r=e-this.index;if(!r&&this.current===s)return;const n=this.current;if(this.index!==e){const i=this._index;this._index=e,this.attached&&i>0!=e>0&&this.sync()}this.history[e]=s,this.ee.emit("change",{navigator:this,from:n,to:this.current,delta:r})}sync(){this.postEvent("web_app_setup_back_button",{is_visible:!!this.index})}}function H({params:t,...e}){return{...t||{hash:"",search:""},...e}}function q(t){const e=typeof t=="string"?t.startsWith("/"):!!(t.pathname&&t.pathname.startsWith("/")),s=R(t);return`${e?s.pathname:s.pathname.slice(1)}${s.search}${s.hash}`}function G(t,e,s){let r,n;typeof t=="string"?r=t:(r=q(t),s=t.state,n=t.id);const{pathname:i,search:o,hash:a}=new URL(r,`http://a${N(e,"/")}`);return{id:n,pathname:i,params:{hash:a,search:o,state:s}}}async function x(t){return t===0?!0:Promise.race([new Promise(e=>{const s=J("popstate",()=>{s(),e(!0)});window.history.go(t)}),new Promise(e=>{setTimeout(e,50,!1)})])}async function Ts(){if(window.history.length<=1||(window.history.pushState(null,""),await x(1-window.history.length)))return;let e=await x(-1);for(;e;)e=await x(-1)}function _e(t){return R(t).pathname}const me=0,z=1,F=2;class fe{constructor(e,s,{postEvent:r,hashMode:n="classic",base:i}={}){c(this,"navigator");c(this,"ee",new S);c(this,"hashMode");c(this,"base");c(this,"attached",!1);c(this,"onPopState",({state:e})=>{if(e===null)return this.push(this.parsePath(window.location.href));e===me?window.history.forward():e===z&&this.back(),e===F&&this.forward()});c(this,"onNavigatorChange",async({to:e,from:s,delta:r})=>{this.attached&&await this.syncHistory(),this.ee.emit("change",{delta:r,from:H(s),to:H(e),navigator:this})});c(this,"on",this.ee.on.bind(this.ee));c(this,"off",this.ee.off.bind(this.ee));this.navigator=new Et(e.map(o=>G(o,"/")),s,r),this.navigator.on("change",o=>{this.onNavigatorChange(o)}),this.hashMode=n,this.base=_e(i||"")}async attach(){this.attached||(this.attached=!0,this.navigator.attach(),window.addEventListener("popstate",this.onPopState),await this.syncHistory())}back(){this.navigator.back()}detach(){this.attached=!1,this.navigator.detach(),window.removeEventListener("popstate",this.onPopState)}forward(){return this.navigator.forward()}get index(){return this.navigator.index}get id(){return this.navigator.current.id}go(e,s){return this.navigator.go(e,s)}goTo(e,s){this.navigator.goTo(e,s)}get hash(){return(this.navigator.current.params||{}).hash||""}get hasPrev(){return this.navigator.hasPrev}get hasNext(){return this.navigator.hasNext}get history(){return this.navigator.history.map(H)}get path(){return q(this)}get pathname(){return this.navigator.current.pathname}parsePath(e){let s=R(e);return this.hashMode&&(s=R(s.hash.slice(1))),{pathname:s.pathname,search:s.search,hash:s.hash}}push(e,s){const r=G(e,this.path),{state:n=s}=r.params;this.navigator.push({...r,params:{...r.params,state:n}})}replace(e,s){const r=G(e,this.path),{state:n=s}=r.params;this.navigator.replace({...r,params:{...r.params,state:n}})}renderPath(e){const s=(this.base.length===1?"":this.base)+N(q(e),"/");return this.hashMode?N(s.slice(1),this.hashMode==="classic"?"#":"#/"):s}async syncHistory(){window.removeEventListener("popstate",this.onPopState);const{state:e}=this,s=this.renderPath(this);await Ts(),this.hasPrev&&this.hasNext?(window.history.replaceState(z,""),window.history.pushState(e,"",s),window.history.pushState(F,""),await x(-1)):this.hasPrev?(window.history.replaceState(z,""),window.history.pushState(e,"",s)):this.hasNext?(window.history.replaceState(e,s),window.history.pushState(F,""),await x(-1)):(window.history.replaceState(me,""),window.history.pushState(e,"",s)),window.addEventListener("popstate",this.onPopState)}get search(){return(this.navigator.current.params||{}).search||""}get state(){return(this.navigator.current.params||{}).state}}function vt(t){t||(t={});const{href:e,hash:s}=window.location;let r=q(t.hashMode===null?e:s.includes("?")?s.slice(1):`?${s.slice(1)}`);const n=t.base?_e(t.base):void 0;if(n){if(!r.startsWith(n))throw f(xe,`Path "${r}" expected to be starting with "${n}"`);r=r.slice(n.length)}return new fe([r],0,t)}function Cs(t){const e=t.match(/#(.+)/);return e?e[1]:null}function As(t,e){if(pe()){const s=sessionStorage.getItem(t);if(s)try{const{index:r,history:n}=JSON.parse(s);return new fe(n,r,e)}catch(r){console.error("Unable to restore hash navigator state.",r)}}return vt(e)}function Is(t,e){const s=As(t,e),r=()=>sessionStorage.setItem(t,JSON.stringify({index:s.index,history:s.history}));return s.on("change",r),r(),s}exports.BackButton=He;exports.BasicNavigator=Et;exports.BiometryManager=st;exports.BrowserNavigator=fe;exports.ClosingBehavior=nt;exports.CloudStorage=ot;exports.ERR_INVALID_PATH_BASE=xe;exports.ERR_INVOKE_CUSTOM_METHOD_RESPONSE=Re;exports.ERR_METHOD_PARAMETER_UNSUPPORTED=Se;exports.ERR_METHOD_UNSUPPORTED=ve;exports.ERR_NAVIGATION_HISTORY_EMPTY=Ae;exports.ERR_NAVIGATION_INDEX_INVALID=Ie;exports.ERR_NAVIGATION_ITEM_INVALID=It;exports.ERR_PARSE=Z;exports.ERR_SSR_INIT=xt;exports.ERR_TIMED_OUT=Te;exports.ERR_UNEXPECTED_TYPE=Ce;exports.ERR_UNKNOWN_ENV=Pe;exports.EventEmitter=S;exports.HapticFeedback=at;exports.InitData=ct;exports.Invoice=pt;exports.MainButton=ht;exports.MiniApp=lt;exports.Popup=dt;exports.QRScanner=_t;exports.SDKError=k;exports.SettingsButton=ft;exports.SwipeBehavior=gt;exports.ThemeParams=bt;exports.Utils=wt;exports.Viewport=mt;exports.array=it;exports.bindMiniAppCSSVars=ws;exports.bindThemeParamsCSSVars=ms;exports.bindViewportCSSVars=ys;exports.boolean=w;exports.captureSameReq=te;exports.classNames=B;exports.compareVersions=De;exports.createBrowserNavigatorFromLocation=vt;exports.createPostEvent=Ue;exports.createSafeURL=R;exports.date=ae;exports.getHash=Cs;exports.getPathname=_e;exports.initBackButton=Yt;exports.initBiometryManager=Kt;exports.initClosingBehavior=Qt;exports.initCloudStorage=es;exports.initHapticFeedback=ts;exports.initInitData=ss;exports.initInvoice=ns;exports.initMainButton=is;exports.initMiniApp=cs;exports.initNavigator=Is;exports.initPopup=hs;exports.initQRScanner=us;exports.initSettingsButton=ls;exports.initSwipeBehavior=ds;exports.initThemeParams=_s;exports.initUtils=gs;exports.initViewport=bs;exports.initWeb=Es;exports.invokeCustomMethod=v;exports.isColorDark=ne;exports.isIframe=ee;exports.isPageReload=pe;exports.isRGB=U;exports.isRGBShort=$e;exports.isSDKError=yt;exports.isSDKErrorOfType=Rs;exports.isSSR=vs;exports.isTMA=Ss;exports.json=g;exports.mergeClassNames=Ut;exports.mockTelegramEnv=Ps;exports.number=y;exports.off=D;exports.on=b;exports.parseInitData=rs;exports.parseLaunchParams=$;exports.parseThemeParams=le;exports.postEvent=P;exports.request=d;exports.requestBiometryInfo=rt;exports.requestThemeParams=fs;exports.requestViewport=de;exports.retrieveLaunchParams=et;exports.rgb=ze;exports.searchParams=O;exports.serializeLaunchParams=Xe;exports.serializeThemeParams=ce;exports.setCSSVar=m;exports.setDebug=Ct;exports.setTargetOrigin=Lt;exports.string=h;exports.subscribe=Ee;exports.supports=E;exports.targetOrigin=Le;exports.toRGB=re;exports.unsubscribe=K;exports.urlToPath=q;exports.withTimeout=se;
//# sourceMappingURL=index.cjs.map
